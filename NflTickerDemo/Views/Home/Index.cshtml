<h1>Welcome</h1>

<div id="ticker-controls">
  <fieldset>
    <legend>Select tickers to display</legend>
    <label>
      <input type="checkbox" id="cb-nfl" data-target="nfl-ticker" checked>
      NFLTicker
    </label>
    <label>
      <input type="checkbox" id="cb-nba" data-target="nba-ticker" checked>
      NBATicker
    </label>
    <label>
      <input type="checkbox" id="cb-nhl" data-target="nhl-ticker" checked>
      NHLTicker
    </label>
  </fieldset>
</div>

<div id="nfl-ticker">
  @await Component.InvokeAsync("NFLTicker")
</div>
<div id="nba-ticker">
  @await Component.InvokeAsync("NBATicker")
</div>
<div id="nhl-ticker">
  @await Component.InvokeAsync("NHLTicker")
</div>

<script>
  (function () {
    var STORAGE_KEY = 'sportsTickerSelections';

    function loadSelections() {
      try {
        var raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : null;
      } catch (e) {
        return null;
      }
    }

    function saveSelections(checkboxes) {
      var selections = {};
      checkboxes.forEach(function (cb) {
        selections[cb.id] = !!cb.checked;
      });
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(selections));
      } catch (e) {
        // ignore storage errors
      }
    }

    function updateVisibility(checkbox) {
      var targetId = checkbox.getAttribute('data-target');
      var el = document.getElementById(targetId);
      if (!el) return;
      el.style.display = checkbox.checked ? '' : 'none';
    }

    var checkboxes = Array.prototype.slice.call(document.querySelectorAll('#ticker-controls input[type="checkbox"]'));

    // Restore previous selections if available
    var saved = loadSelections();
    if (saved) {
      checkboxes.forEach(function (cb) {
        if (saved.hasOwnProperty(cb.id)) {
          cb.checked = !!saved[cb.id];
        }
      });
    }

    // Initialize visibility on page load
    checkboxes.forEach(function (cb) { updateVisibility(cb); });

    // Toggle on change and persist
    checkboxes.forEach(function (cb) {
      cb.addEventListener('change', function () {
        updateVisibility(cb);
        saveSelections(checkboxes);
      });
    });
  })();
</script>
